
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“š ë¹„í–‰ì´ë¡  ì˜¤ë‹µë…¸íŠ¸ í’€ê¸°</title>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      background: linear-gradient(to bottom, #aee1f9, #f0f8ff);
      margin: 0;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      min-height: 100vh;
    }
    .card {
      background: white;
      margin-top: 100px;
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      width: 100%;
      max-width: 600px;
      text-align: center;
    }
    h1 {
      font-size: 2rem;
      color: #0056b3;
      margin-bottom: 1rem;
    }
    #scoreboard {
      font-size: 1rem;
      margin-bottom: 1rem;
      color: #555;
    }
    #question {
      font-size: 1.2rem;
      text-align: left;
      margin-bottom: 1rem;
      font-weight: bold;
    }
    #choices {
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    #choices button {
      margin: 0.5rem 0;
      padding: 0.8rem;
      font-size: 1.1rem;
      border-radius: 12px;
      border: none;
      background: linear-gradient(to right, #6fb1fc, #4364f7);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    #choices button:hover {
      background: linear-gradient(to right, #4364f7, #6fb1fc);
    }
    #feedback {
      margin-top: 1rem;
      font-weight: bold;
      font-size: 1.2rem;
    }
    #answer {
      margin-top: 1rem;
      display: none;
      font-size: 1rem;
      color: #777;
      white-space: pre-line;
    }
    button.action-btn {
      margin-top: 1rem;
      padding: 0.8rem;
      font-size: 1.2rem;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
    }
    #next-btn { background: #007BFF; color: white; }
    #home-btn { background: #6c757d; color: white; }
    #reset-btn { background: #dc3545; color: white; }
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ“š ë¹„í–‰ì´ë¡  ì˜¤ë‹µë…¸íŠ¸ í’€ê¸°</h1>
    <div id="scoreboard">ë¬¸ì œ ë¡œë”© ì¤‘...</div>
    <div id="question">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</div>
    <div id="choices"></div>
    <div id="feedback"></div>
    <div id="answer"></div>
    <button type="button" id="next-btn" class="action-btn" style="display:none;">ë‹¤ìŒ ë¬¸ì œ</button>
    <button type="button" id="home-btn" class="action-btn" onclick="location.href='./index.html'" style="display:none;">ë©”ì¸í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</button>
    <button type="button" id="reset-btn" class="action-btn" onclick="resetWrongNotes()" style="display:none;">ì˜¤ë‹µë…¸íŠ¸ ì´ˆê¸°í™”</button>
  </div>

<script>
let wrongNotes = JSON.parse(localStorage.getItem('wrongNotes_flight') || '[]');
let currentProblems = [];
let current = 0;
let correctCount = 0;
let totalCount = 0;
let answered = false;

function extractCorrectAnswer(problem) {
  if (!problem.correct) return '';
  const match = problem.correct.match(/\d/);
  return match ? match[0] : '';
}

function getSelectedAnswer(selectedText) {
  switch (selectedText.trim().charAt(0)) {
    case 'â‘ ': return '1';
    case 'â‘¡': return '2';
    case 'â‘¢': return '3';
    case 'â‘£': return '4';
    default: return '';
  }
}

function setupQuiz() {
  if (wrongNotes.length === 0) {
    document.getElementById('scoreboard').innerText = "ğŸ‰ ì˜¤ë‹µë…¸íŠ¸ì— ë‚¨ì€ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!";
    document.getElementById('question').innerText = "ë©”ì¸í˜ì´ì§€ë¡œ ëŒì•„ê°€ì£¼ì„¸ìš”.";
    document.getElementById('choices').innerHTML = '';
    document.getElementById('feedback').innerText = '';
    document.getElementById('answer').style.display = 'none';
    document.getElementById('next-btn').style.display = 'none';
    document.getElementById('home-btn').style.display = 'block';
    document.getElementById('reset-btn').style.display = 'block';
    return;
  }
  currentProblems = [...wrongNotes];
  document.getElementById('next-btn').style.display = 'block';
  document.getElementById('home-btn').style.display = 'block';
  document.getElementById('reset-btn').style.display = 'block';
  nextQuestion();
}

function updateScoreboard() {
  let percentage = totalCount === 0 ? 0 : Math.round((correctCount / totalCount) * 100);
  document.getElementById('scoreboard').innerText = 
    `í˜„ì¬ê¹Œì§€ ${totalCount}ë¬¸ì œ í’€ì—ˆê³ , ${correctCount}ë¬¸ì œ ë§ì·„ìŠµë‹ˆë‹¤. (ì •ë‹µë¥  ${percentage}%)`;
}

function nextQuestion() {
  if (currentProblems.length === 0) {
    finishQuiz();
    return;
  }
  const randomIndex = Math.floor(Math.random() * currentProblems.length);
  current = randomIndex;
  answered = false;
  document.getElementById('question').innerText = currentProblems[randomIndex].question;
  const choicesDiv = document.getElementById('choices');
  choicesDiv.innerHTML = '';
  currentProblems[randomIndex].choices.forEach(choice => {
    const btn = document.createElement('button');
    btn.textContent = choice;
    btn.onclick = () => checkAnswer(choice);
    choicesDiv.appendChild(btn);
  });
  document.getElementById('feedback').innerText = '';
  document.getElementById('answer').style.display = 'none';
}

function checkAnswer(selected) {
  if (answered) return;
  answered = true;
  totalCount += 1;

  const correct = extractCorrectAnswer(currentProblems[current]);
  const selectedValue = getSelectedAnswer(selected);

  if (selectedValue === correct) {
    correctCount += 1;
    document.getElementById('feedback').innerText = 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ¯';
    document.getElementById('feedback').style.color = 'green';
  } else {
    document.getElementById('feedback').innerText = `ì˜¤ë‹µì…ë‹ˆë‹¤ ğŸ˜¢ ì •ë‹µì€ (${correct})ì…ë‹ˆë‹¤.`;
    document.getElementById('feedback').style.color = 'red';
  }

  document.getElementById('answer').innerText = currentProblems[current].explanation || "";
  document.getElementById('answer').style.display = 'block';
  currentProblems.splice(current, 1);
  updateScoreboard();
}

function finishQuiz() {
  document.getElementById('scoreboard').innerText = "ğŸ‰ ëª¨ë“  ì˜¤ë‹µ ë¬¸ì œë¥¼ ë‹¤ í’€ì—ˆìŠµë‹ˆë‹¤!";
  document.getElementById('question').innerText = "ë‚¨ì€ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.";
  document.getElementById('choices').innerHTML = '';
  document.getElementById('feedback').innerText = '';
  document.getElementById('answer').style.display = 'none';
  document.getElementById('next-btn').style.display = 'none';
}

function resetWrongNotes() {
  localStorage.removeItem('wrongNotes_flight');
  alert('ë¹„í–‰ì´ë¡  ì˜¤ë‹µë…¸íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤! ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
  location.href = './index.html';
}

document.getElementById('next-btn').addEventListener('click', nextQuestion);

setupQuiz();
</script>

</body>
</html>

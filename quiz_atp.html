<!-- quiz_atp.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ATP 문제 풀기</title>
  <script src="problems.js"></script> <!-- 문제 스크립트 파일 불러오기 -->
  <link rel="stylesheet" href="style.css"> <!-- 필요한 경우 스타일 -->
</head>
<body>
  <div class="quiz-container">
    <h1>ATP Random Question ✈️</h1>
    <div id="score"></div>
    <div id="question">문제 로딩 중...</div>
    <div id="choices"></div>
    <div id="feedback"></div>
    <div id="answer" style="display: none;"></div>
    <button id="next-btn" onclick="nextQuestion()">다음 문제</button>
    <button onclick="location.href='index.html'">메인페이지로 돌아가기</button>
    <button onclick="location.href='wrongnote_atp.html'">오답노트 풀기</button>
  </div>

  <script>
    let problems = window.problems; // 문제 데이터 사용
    let current = 0;
    let correctCount = 0;
    let totalCount = 0;
    let answered = false;
    let wrongProblems = [];

    function setupQuiz() {
      if (problems.length === 0) {
        document.getElementById('question').innerText = "현재 문제가 없습니다.";
        return;
      }
      showProblem();
    }

    function showProblem() {
      if (current >= problems.length) {
        document.getElementById('question').innerHTML = "🎉 모든 문제를 다 풀었습니다!";
        document.getElementById('choices').innerHTML = "";
        document.getElementById('next-btn').style.display = 'none';
        return;
      }

      const problem = problems[current];
      document.getElementById('question').innerText = problem.question;

      const choicesDiv = document.getElementById('choices');
      choicesDiv.innerHTML = '';
      problem.choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.innerText = choice;
        btn.onclick = () => checkAnswer(choice);
        choicesDiv.appendChild(btn);
      });

      document.getElementById('feedback').innerText = '';
      document.getElementById('answer').style.display = 'none';
    }

    function checkAnswer(selected) {
      if (answered) return;
      answered = true;
      totalCount++;

      const correctChoice = problems[current].choices.find(c => c.startsWith(problems[current].correct));
      if (selected.startsWith(problems[current].correct)) {
        correctCount++;
        document.getElementById('feedback').innerText = "정답입니다! 🎉";
        document.getElementById('feedback').style.color = 'green';
      } else {
        wrongProblems.push(problems[current]);
        document.getElementById('feedback').innerText = `오답입니다 🤭 \n정답은: ${correctChoice}`;
        document.getElementById('feedback').style.color = 'red';
      }
      document.getElementById('answer').innerText = problems[current].explanation;
      document.getElementById('answer').style.display = 'block';
    }

    function nextQuestion() {
      answered = false;
      current++;
      showProblem();
    }

    setupQuiz();
  </script>
</body>
</html>

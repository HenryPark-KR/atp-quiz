
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ATP Random Question ✈️</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom, #87CEFA, #f0f8ff);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .card {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      width: 100%;
      max-width: 600px;
      text-align: center;
    }
    h1 {
      font-size: 2rem;
      color: #004080;
      margin-bottom: 0.5rem;
    }
    #mode {
      font-size: 1rem;
      color: #28a745;
      margin-bottom: 1rem;
    }
    #scoreboard {
      font-size: 1rem;
      margin-bottom: 1rem;
      color: #333;
    }
    #question {
      font-size: 1.3rem;
      margin-bottom: 1rem;
    }
    #choices {
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    #choices button {
      margin: 0.5rem 0;
      padding: 0.8rem 1rem;
      font-size: 1.1rem;
      border-radius: 10px;
      border: 2px solid #007BFF;
      background: white;
      color: black;
      transition: background 0.3s, color 0.3s;
    }
    #choices button:hover {
      background: #007BFF;
      color: white;
    }
    #feedback {
      margin-top: 1rem;
      font-weight: bold;
      font-size: 1.2rem;
    }
    #answer {
      margin-top: 1rem;
      display: none;
      font-size: 1rem;
      color: #555;
      white-space: pre-line;
    }
    button.action-btn {
      margin-top: 1rem;
      padding: 0.8rem 1rem;
      font-size: 1.2rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      width: 100%;
    }
    #next-btn { background: #007BFF; color: white; }
    #reset-btn { background: #dc3545; color: white; }
    #home-btn { background: #6c757d; color: white; }
  </style>
  <script src="./problems.js"></script>
</head>
<body>
  <div class="card">
    <h1>ATP Random Question ✈️</h1>
    <div id="mode"></div>
    <div id="scoreboard">현재까지 0문제 풀었고, 0문제 맞췄습니다. (정답률 0%)</div>
    <div id="question">로딩 중...</div>
    <div id="choices"></div>
    <div id="feedback"></div>
    <div id="answer"></div>
    <button type="button" id="next-btn" class="action-btn">다음 문제</button>
    <button type="button" id="reset-btn" class="action-btn">오답노트 초기화</button>
    <button type="button" id="home-btn" class="action-btn" onclick="location.href='./index.html'">메인페이지로 돌아가기</button>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  let currentProblems = [];
  let current = 0;
  let correctCount = 0;
  let totalCount = 0;
  let answered = false;
  let wrongAnswers = JSON.parse(localStorage.getItem('wrongAnswers')) || [];
  let isWrongNoteMode = false;

  const params = new URLSearchParams(window.location.search);
  const mode = params.get('mode') || 'normal';

  if (mode === 'wrongnote') {
    isWrongNoteMode = true;
    currentProblems = [...wrongAnswers];
  } else {
    isWrongNoteMode = false;
    currentProblems = [...problems];
  }

  function updateScoreboard() {
    let percentage = totalCount === 0 ? 0 : Math.round((correctCount / totalCount) * 100);
    document.getElementById('scoreboard').innerText = 
      `현재까지 ${totalCount}문제 풀었고, ${correctCount}문제 맞췄습니다. (정답률 ${percentage}%)`;
  }

  function updateMode() {
    document.getElementById('mode').innerText = isWrongNoteMode ? "[오답노트 모드 ✈️]" : "";
  }

  function nextQuestion() {
    if (currentProblems.length === 0) {
      document.getElementById('question').innerText = "모든 문제를 다 풀었습니다! 🎯";
      document.getElementById('choices').innerHTML = '';
      document.getElementById('next-btn').style.display = 'none';
      return;
    }
    const randomIndex = Math.floor(Math.random() * currentProblems.length);
    current = randomIndex;
    answered = false;
    document.getElementById('question').innerText = currentProblems[randomIndex].question;
    const choicesDiv = document.getElementById('choices');
    choicesDiv.innerHTML = '';
    currentProblems[randomIndex].choices.forEach(choice => {
      const btn = document.createElement('button');
      btn.textContent = choice;
      btn.onclick = () => checkAnswer(choice.charAt(0));
      choicesDiv.appendChild(btn);
    });
    document.getElementById('feedback').innerText = '';
    document.getElementById('answer').style.display = 'none';
  }

  function checkAnswer(selected) {
    if (answered) return;
    answered = true;
    totalCount += 1;
    const correct = currentProblems[current].correct;
    if (selected === correct) {
      correctCount += 1;
      document.getElementById('feedback').innerText = '정답입니다! 🎯';
      document.getElementById('feedback').style.color = 'green';
    } else {
      wrongAnswers.push({...currentProblems[current]});
      localStorage.setItem('wrongAnswers', JSON.stringify(wrongAnswers));
      document.getElementById('feedback').innerText = '오답입니다 😢 정답은 (' + correct + ')입니다.';
      document.getElementById('feedback').style.color = 'red';
    }
    document.getElementById('answer').innerText = currentProblems[current].explanation;
    document.getElementById('answer').style.display = 'block';
    currentProblems.splice(current, 1);
    updateScoreboard();
  }

  function resetWrongNote() {
    wrongAnswers = [];
    localStorage.removeItem('wrongAnswers');
    currentProblems = [];
    correctCount = 0;
    totalCount = 0;
    alert("오답노트가 초기화되었습니다! ✈️ 메인페이지로 이동합니다.");
    window.location.href = "./index.html";
  }

  updateMode();
  updateScoreboard();
  nextQuestion();

  document.getElementById('next-btn').addEventListener('click', nextQuestion);
  document.getElementById('reset-btn').addEventListener('click', resetWrongNote);
});
</script>

</body>
</html>
